<html>
<head></head>
<body>
  <script>
    <% if @user %>
      window.opener.Ember.SimpleAuth.externalLoginSucceeded(<%= raw UserSerializer.new(@user).as_json.merge(access_token: @user.api_token).to_json %>);
    <% else %>
      window.opener.Ember.SimpleAuth.externalLoginFailed({ error: 'invalid_grant' });
    <% end %>

    window.close();
  </script>
</body>
</html>